<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Date and Time Converter</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center"><i class="fas fa-clock"></i> Date and Time Converter</h1>

        <form id="conversionForm">
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="fromDateTime">From Date and Time:</label>
                    <input type="datetime-local" class="form-control" id="fromDateTime">
                </div>
                <div class="form-group col-md-6">
                    <label for="fromTimezone">From Timezone (optional):</label>
                    <select class="form-control" id="fromTimezone">
                        <option value="">Browser Local</option>
                        </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="toDateTime">To Date and Time:</label>
                    <input type="datetime-local" class="form-control" id="toDateTime">
                </div>
                <div class="form-group col-md-6">
                    <label for="toTimezone">To Timezone (optional):</label>
                    <select class="form-control" id="toTimezone">
                        <option value="">Browser Local</option>
                        </select>
                </div>
            </div>

            <div class="form-group">
                <div class="bg-light p-3 rounded">
                  <div class="d-flex justify-content-between align-items-center">
                      <label class="mb-0">Select Timezones to Convert To:</label>
                      <button type="button" class="btn btn-outline-secondary btn-sm" id="toggleTimezoneList">
                          <i class="fas fa-chevron-down"></i> Expand
                      </button>
                  </div>
                  <div class="timezone-list mt-2" id="timezoneList" style="display: none;"></div>
                  <div class="text-right mt-2">
                      <button type="button" class="btn btn-secondary btn-sm" id="uncheckAllBtn">Uncheck All</button>
                  </div>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Convert</button>
        </form>

        <div id="results" class="mt-4">
            <div class="text-output" id="textOutput"></div>
            <div class="table-responsive" id="tableOutput"></div>
        </div>
    </div>

    <script>
        const timezones = [
            "Africa/Cairo",
            "Africa/Johannesburg",
            "America/Anchorage",
            "America/Buenos_Aires",
            "America/Chicago",
            "America/Denver",
            "America/Los_Angeles",
            "America/Mexico_City",
            "America/New_York",
            "America/Phoenix",
            "America/Sao_Paulo",
            "Asia/Dubai",
            "Asia/Kolkata",
            "Asia/Manila",
            "Asia/Shanghai",
            "Asia/Singapore",
            "Asia/Tokyo",
            "Australia/Brisbane",
            "Australia/Melbourne",
            "Australia/Sydney",
            "Europe/Berlin",
            "Europe/London",
            "Europe/Madrid",
            "Europe/Moscow",
            "Europe/Paris",
            "Europe/Rome",
            "Pacific/Auckland",
            "UTC"
        ];

        function populateTimezoneDropdowns() {
            const timezoneDropdowns = document.querySelectorAll("#fromTimezone, #toTimezone");
            timezones.forEach(timezone => {
                timezoneDropdowns.forEach(dropdown => {
                    const option = document.createElement("option");
                    option.value = timezone;
                    option.text = timezone;
                    dropdown.add(option);
                });
            });
        }

        function createTimezoneCheckboxes() {
            const timezoneList = document.getElementById("timezoneList");
            timezoneList.innerHTML = '';
            timezones.forEach(timezone => {
                const checkboxId = `checkbox-${timezone}`;
                const div = document.createElement("div");
                div.classList.add("form-check", "form-check-inline");
                div.innerHTML = `
                    <input type="checkbox" class="form-check-input" id="${checkboxId}" value="${timezone}">
                    <label class="form-check-label" for="${checkboxId}">${timezone}</label>
                `;
                timezoneList.appendChild(div);
            });
        }

        function getSelectedTimezones() {
            const selectedTimezones = [];
            const checkboxes = document.querySelectorAll("#timezoneList input[type=checkbox]:checked");
            checkboxes.forEach(checkbox => {
                selectedTimezones.push(checkbox.value);
            });
            return selectedTimezones;
        }

        function saveToLocalStorage() {
            localStorage.setItem("fromDateTime", document.getElementById("fromDateTime").value);
            localStorage.setItem("fromTimezone", document.getElementById("fromTimezone").value);
            localStorage.setItem("toDateTime", document.getElementById("toDateTime").value);
            localStorage.setItem("toTimezone", document.getElementById("toTimezone").value);
            const selectedTimezones = [];
            const checkboxes = document.querySelectorAll("#timezoneList input[type=checkbox]");
            checkboxes.forEach(checkbox => {
                selectedTimezones.push({
                    timezone: checkbox.value,
                    checked: checkbox.checked
                });
            });
            localStorage.setItem("selectedTimezones", JSON.stringify(selectedTimezones));
        }

        function loadFromLocalStorage() {
            const fromDateTime = localStorage.getItem("fromDateTime");
            const fromTimezone = localStorage.getItem("fromTimezone");
            const toDateTime = localStorage.getItem("toDateTime");
            const toTimezone = localStorage.getItem("toTimezone");
            const storedTimezones = JSON.parse(localStorage.getItem("selectedTimezones"));

            if (fromDateTime) document.getElementById("fromDateTime").value = fromDateTime;
            if (fromTimezone) document.getElementById("fromTimezone").value = fromTimezone;
            if (toDateTime) document.getElementById("toDateTime").value = toDateTime;
            if (toTimezone) document.getElementById("toTimezone").value = toTimezone;

            if (storedTimezones) {
                storedTimezones.forEach(item => {
                    const checkbox = document.getElementById(`checkbox-${item.timezone}`);
                    if (checkbox) checkbox.checked = item.checked;
                });
            }
        }

        function convertAndDisplay() {
            const fromDateTimeLocal = document.getElementById("fromDateTime").value;
            const fromTimezone = document.getElementById("fromTimezone").value || Intl.DateTimeFormat().resolvedOptions().timeZone;
            const toDateTimeLocal = document.getElementById("toDateTime").value;
            const toTimezone = document.getElementById("toTimezone").value || Intl.DateTimeFormat().resolvedOptions().timeZone;
            const selectedTimezones = getSelectedTimezones();

            if (!fromDateTimeLocal || !toDateTimeLocal) {
                alert("Please fill in all input fields.");
                return;
            }

            if (selectedTimezones.length === 0) {
                alert("Please select at least one timezone to convert to.");
                return;
            }

            const fromDate = new Date(fromDateTimeLocal);
            const toDate = new Date(toDateTimeLocal);

            if (fromDate > toDate) {
                alert("The start date cannot be later than the end date.");
                return;
            }

            const fromOffset = fromTimezone ? -fromDate.getTimezoneOffset() : 0;
            const toOffset = toTimezone ? -toDate.getTimezoneOffset() : 0;

            const fromDateTimeUTC = new Date(fromDate.getTime() + fromOffset * 60000);
            const toDateTimeUTC = new Date(toDate.getTime() + toOffset * 60000);

            const resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML = ""; // Clear previous results

            let textOutput = "";
            selectedTimezones.forEach(timezone => {
                const fromConverted = convertToTimezone(fromDateTimeUTC, timezone);
                const toConverted = convertToTimezone(toDateTimeUTC, timezone);

                textOutput += `Timezone: ${timezone}\n`;
                textOutput += `From: ${fromConverted}\n`;
                textOutput += `To: ${toConverted}\n`;
                textOutput += `---\n`;
            });

            const textOutputDiv = document.createElement("div");
            textOutputDiv.id = "textOutput";
            textOutputDiv.classList.add("text-output", "bg-light", "p-3", "rounded", "mb-3");
            textOutputDiv.textContent = textOutput;
            resultsDiv.appendChild(textOutputDiv);

            // Create table output
            const table = document.createElement("table");
            table.classList.add("table", "table-striped");
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Timezone</th>
                        <th>From</th>
                        <th>To</th>
                    </tr>
                </thead>
                <tbody></tbody>
            `;
            const tbody = table.querySelector("tbody");

            selectedTimezones.forEach(timezone => {
                const fromConverted = convertToTimezone(fromDateTimeUTC, timezone);
                const toConverted = convertToTimezone(toDateTimeUTC, timezone);

                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${timezone}</td>
                    <td>${fromConverted}</td>
                    <td>${toConverted}</td>
                `;
            });

            const tableOutputDiv = document.createElement("div");
            tableOutputDiv.id = "tableOutput";
            tableOutputDiv.classList.add("table-responsive");
            tableOutputDiv.appendChild(table); // Add table to the div
            resultsDiv.appendChild(tableOutputDiv); // Add div to the results
        }

        function convertToTimezone(date, timezone) {
            const formatter = new Intl.DateTimeFormat('en-US', {
                timeZone: timezone,
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
            });

            const formattedDate = formatter.format(date);
            const parts = formattedDate.split(', ');
            const datePart = parts[0].split('/');
            const timePart = parts[1].split(' ');

            const month = datePart[0];
            const day = datePart[1];
            const year = datePart[2];
            const hour = timePart[0].split(':')[0];
            const minute = timePart[0].split(':')[1];
            const second = timePart[0].split(':')[2];
            const ampm = timePart[1];

            return `${month}/${day}/${year}, ${hour}:${minute}:${second} ${ampm}`;
        }

        document.addEventListener("DOMContentLoaded", () => {
            populateTimezoneDropdowns();
            createTimezoneCheckboxes();
            loadFromLocalStorage();

            const toggleButton = document.getElementById("toggleTimezoneList");
            const timezoneListContainer = document.querySelector(".timezone-list").parentNode;
            toggleButton.addEventListener("click", () => {
                const timezoneList = document.getElementById("timezoneList");
                timezoneList.style.display = timezoneList.style.display === "none" ? "block" : "none";
                toggleButton.innerHTML = timezoneList.style.display === "none" ? '<i class="fas fa-chevron-down"></i> Expand' : '<i class="fas fa-chevron-up"></i> Collapse';
            });

            const uncheckAllBtn = document.getElementById("uncheckAllBtn");
            uncheckAllBtn.addEventListener("click", () => {
                const checkboxes = document.querySelectorAll("#timezoneList input[type=checkbox]");
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
            });

            document.getElementById("conversionForm").addEventListener("submit", (event) => {
                event.preventDefault();
                saveToLocalStorage();
                convertAndDisplay();
            });
        });
    </script>
</body>
</html>
